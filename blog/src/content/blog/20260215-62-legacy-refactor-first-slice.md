---
title: "이제 슬슬 회사 코드베이스가 파악되는데 스프링코드 장고로 했으면 코드 10%도 안됐다."
description: "느린 테스트와 리팩토링 저항 속에서 모듈 분리 첫 조각을 배포하며 정리한, 분리 시점과 실행 순서에 대한 기록."
pubDate: "2024-07-02T15:55:05+00:00"
source: twitter
tags:
  - 레거시
  - 리팩토링
  - 모듈분리
  - 테스트
  - 아키텍처
---

코드베이스를 파악하면서 먼저 부딪힌 건 생산성보다 피로였다. 같은 기능을 다른 스택으로 만들었을 때보다 코드 양이 과하게 늘어났고, 테스트 하나에 1분이 걸리니 TDD를 말하기도 어려웠다. 문제는 의지의 부족이 아니라 피드백 루프가 이미 깨져 있었다는 점이다. 이 상태가 길어지면 개선보다 회피가 먼저 생기고, 변경 비용은 계속 올라간다.

처음엔 비즈니스 로직을 플레인 자바로 크게 분리할지 고민했다. 다만 한 번에 뒤집으면 반발이 커질 게 보여서, 모듈 분리 한 조각을 먼저 배포하는 쪽을 택했다. PR을 올리자마자 동료 한 분을 붙잡아 대면 리뷰를 받고 바로 반영했다. 레거시 리팩토링에 왜 리소스를 쓰냐는 질문이 나올 수 있다는 전제를 깔고, 설명 문서보다 작게 증명하는 실행을 우선했다. 중복 코드나 추상화도 바로 일반화하지 않고, 불편한 지점을 먼저 글로 써서 우선순위를 정했다.

실행 과정은 깔끔하지 않았다. 직관적이라고 믿었던 설계도 구현에 들어가면 허점이 드러났고, 짧은 시간에 여러 번 갈아엎었다. 그래도 이 반복 덕분에 보기 좋은 구조와 실제로 유지되는 구조를 구분하게 됐다. 첫 분리를 넣고 나니 레거시 전체를 한 덩어리로 상대할 때보다 부담이 줄어든 건 분명했다. 다만 테스트 속도 개선이나 전체 품질 변화는 아직 수치로 정리된 상태가 아니라 단정해서 말하긴 어렵다.

돌아보면 프레임워크 자체보다 분리 시점을 놓친 비용이 더 컸다. 하나의 서비스에 기능을 계속 얹으면 각 기능의 장애 가능성이 곱으로 누적돼 전체 리스크가 불필요하게 커진다. 그래서 지금은 기술 교체 논쟁보다 먼저 경계를 자르고 실패 반경을 줄이는 순서를 잡는다. 테스트 루프가 느리고 변경이 무서워지는 신호가 보이면, 완성도 높은 재설계보다 작게 쪼개서 검증 가능한 단위부터 만드는 편이 결국 빠르다.
