---
title: Node 서비스 엣지 구성에서 단순함과 완충지대를 고른 기준
description: nginx와 LB 직접 종료를 어떤 조건에서 나눴는지, 장애 경험 이후 요청 완충지대를 왜 우선순위에 올렸는지 정리했다.
pubDate: 2023-10-15T06:44:21+00:00
source: twitter
tags:
  - 백엔드
  - 아키텍처
  - nodejs
  - nginx
  - 장애대응
---

Node 서비스 엣지 구성을 말할 때 정답부터 찾기 쉽지만, 실제 기준은 제약이다. 정적 파일 서빙이나 SSL을 별도 계층에서 제어해야 하면 nginx를 두고 리버스 프록시로 Node를 붙인다. 반대로 부하가 크지 않고 요구사항이 단순하면, SSL을 처리하는 로드밸런서 뒤에 Node 포트를 바로 두는 구성이 충분히 실용적이다.

내 기준은 단순하다. 컴포넌트를 늘릴 때 운영 복잡도보다 이득이 큰지 먼저 본다. nginx를 넣으면 제어 지점이 생기지만 관리 대상도 늘어난다. 그래서 필요가 모호하면 경로를 짧게 유지한다. 다만 아키텍처를 제출하거나 설명해야 하는 상황에서는 기술보다 합의 비용이 더 클 수 있다. 그럴 때는 nginx 계층을 명시해 대화 마찰을 줄이는 선택이 오히려 빠르다.

판단이 달라진 계기는 장애였다. 서비스나 DB가 멈춘 구간에서 PG사 요청을 아예 받지 못한 경험이 있었다. 그때부터 처리 실패와 수신 실패를 분리해야 한다고 봤다. 내부가 멈춰도 요청을 일단 받아둘 완충지대가 있어야 한다는 뜻이다. 구현은 팀마다 다르지만, 받아두고 나중에 처리할 경로를 엣지 설계의 기본 항목으로 두면 504가 바로 데이터 손실로 번지는 위험을 낮출 수 있다.

모든 결함을 예방하는 설계는 이상적이지만 현실에서는 비용이 크다. 그래서 실패를 없애기보다 실패의 범위를 제한하는 쪽을 택한다. 기본값은 단순하게, 이유가 분명할 때만 계층을 추가한다. 그리고 장애를 겪었다면 요청 완충 계층을 우선순위에 올린다. 클라우드플레어의 내부 동작은 내가 확인한 정보가 충분하지 않아 이 글에서는 일반적인 선택 기준만 정리했다.
