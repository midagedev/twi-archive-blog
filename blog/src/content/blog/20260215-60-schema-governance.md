---
title: "예전에 게임쪽에 있던 분과 일할 기회가 있었는데 같이 디비설계를 하면서 게임쪽은 FK를 잘 안건다는 이야기를 들었다."
description: FK와 마이그레이션 규율을 어디까지 가져갈지, 쓰기 부하와 운영 비용 사이에서 실제로 판단한 기준을 정리했다.
pubDate: 2023-12-06T14:22:27+00:00
source: twitter
tags:
  - database
  - schema
  - migration
  - tradeoff
---

예전에 게임 도메인 출신 동료와 디비 설계를 하며 “왜 FK를 잘 안 거냐”는 이야기를 들었을 때는 쉽게 이해가 안 됐다. 내 쪽 기본값은 FK를 먼저 두고 무결성을 디비가 책임지게 하는 방식이었기 때문이다. 그런데 외래키 필드 하나를 추가하면서 제약을 거는 작업에서 테이블에 몇 분 단위 읽기 락이 걸리는 걸 직접 겪고 생각이 달라졌다. 쓰기 빈도가 높은 구간에서는 제약 검사 자체의 오버헤드보다도, 제약 변경 과정의 락 비용이 더 크게 체감될 수 있었다.

그래도 원칙은 여전히 FK를 초반부터 쓰는 쪽에 가깝다. FK를 비워두면 결국 애플리케이션 곳곳에 밸리데이션을 중복 작성하게 되고, 시간이 지나면 논리 ERD와 물리 ERD 사이에 설명되지 않은 갭이 생긴다. 그 갭은 문서 한 번으로 끝나지 않고, 온보딩과 장애 분석에서 계속 비용으로 돌아온다. 그래서 FK를 덜 쓰는 선택은 “가능하냐”보다 “그 비용을 넘는 이득이 지금 분명하냐”로 판단해야 한다고 보게 됐다.

스키마 관리 방식도 같은 맥락이었다. 정규화한 RDB를 다루던 시기에는 코드 분기를 줄이려고 데이터와 스키마 마이그레이션을 함께 밀고, 프로덕션에서도 자주 바꿔가며 형태를 맞췄다. 반대로 마이그레이션 없이 스키마를 계속 바꿔 적재하는 환경에서는 초기 속도는 빠를 수 있어도, 어느 순간 “이걸 여러 서비스에서 어떻게 공통으로 쓰지?”라는 질문이 쌓인다. 그때부터는 기능 부채보다 데이터 자체가 부채처럼 느껴진다.

결론은 FK를 쓰느냐 마느냐의 신념 싸움이 아니라, 제약 수준과 보완 장치를 같이 설계하는 운영 문제였다. 쓰기량이 높고 락 허용치가 낮다면 FK를 줄일 수는 있지만, 그 대신 애플리케이션 검증, 배치 정합성 점검, 변경 이력 관리 같은 보완을 먼저 깔아야 한다. 반대로 서비스 경계가 넓고 데이터 재사용이 많다면 초반 FK와 마이그레이션 규율에 투자하는 편이 장기 비용이 낮다. 중요한 건 당장의 구현 속도보다, 시간이 지나도 같은 의미로 데이터를 해석할 수 있게 유지하는 기준을 남기는 일이다.
