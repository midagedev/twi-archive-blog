---
title: "레거시에 대한 경험, 지금와 생각해보면 테스트케이스가 없거나 극단적으로 적은게 본질이었다."
description: 레거시의 통증을 기술 부채 자체가 아니라 검증 루프 부재로 보고, 테스트와 빠른 확인 도구를 우선순위로 재정렬한 경험을 정리했다.
pubDate: 2023-02-28T01:54:12+00:00
source: twitter
tags:
  - legacy
  - test
  - feedback-loop
  - side-effect
---

레거시가 힘들었던 이유를 나중에 다시 정리해보니, 코드가 오래돼서가 아니라 검증 루프가 비어 있었던 게 핵심이었다. 작은 개선 하나를 넣으면 오류가 여러 개 따라왔고, 원인 파악보다 복구가 먼저였다. 이 상태가 길어지면 변경 자체를 피하게 되고, 문제를 푸는 코드보다 문제를 피하는 방어적 코드가 늘어난다. 결국 생산성이 아니라 심리적 비용이 먼저 무너진다.

당시에는 새로 만들기 전에는 별 방법이 없다고 생각했다. 지금 보면 그 판단이 가장 큰 미스였다. 기능 추가보다 먼저 테스트케이스를 확보했어야 했다. 팀 안에서는 작업 공유를 자주 하고, 방향이 어긋난 변경은 왜 잘못됐는지 명확히 짚고 되돌리는 과정을 반복했다. 몇 번의 리버트가 불편하긴 해도, 그 과정이 있어야 기준이 맞춰지고 이후 결정이 더 신중해진다.

실행에서 가장 크게 바꾼 건, 내가 만든 코드가 되는지 내가 즉시 확인할 수 있는 도구를 먼저 쥐는 일이었다. 로컬에서 빠르게 돌리는 테스트와 체크가 없으면 수정하고, 다시 시키고, 또 실행해보는 왕복만 늘어난다. 그 반복은 코드 품질보다 집중력을 먼저 깎는다. 특히 외부 API가 섞인 구간은 같은 파라미터에도 결과가 흔들리기 쉬워서, 상태를 복제한 별도 실행 벌을 두고 재현 가능성부터 확보하려 했다.

물론 한 번에 깔끔해지진 않는다. 레거시에서는 어디부터 테스트를 둘지 자체가 불분명할 때가 많고, 커버리지 숫자만 올려도 체감이 없을 때가 있다. 당시 변화 폭이 정량적으로 얼마나 줄었는지는 기록이 부족해 단정하기 어렵다. 다만 적용 포인트는 분명해졌다. 변경이 잦고 사이드이펙트가 큰 경로부터 테스트를 붙이고, 작은 커밋으로 자주 공유하고, 실패 이유를 문장으로 남긴다. 큰 리팩터링보다 이 루프를 먼저 세우는 편이 결국 덜 깨지고 더 빨리 간다.
