---
title: 서드파티 연동에서 경계를 정하는 기준
description: 결제 스키마 꼬임, API 문서 드리프트, Stripe와 단축 URL 위임 경험으로 정리한 현실적인 연동 설계 기준.
pubDate: 2023-06-27T13:14:11+00:00
source: twitter
tags:
  - 개발
  - 서드파티
  - 결제
  - API
  - 설계
---

서드파티 하나를 붙일 때 가장 먼저 무너지는 건 코드보다 기대값이었다. 실제로 연동 과정에서 예상과 다른 동작을 이틀 사이 일곱 번쯤 만났다. 어떤 API는 처음 설계에 없던 흔적이 보였고, 어떤 구간은 문서 갱신이 늦어 응답 규칙이 달랐다. 다행히 어드민도 같은 API를 써서, 문서 설명보다 실제 호출 결과를 기준으로 동작 범위를 다시 잡을 수 있었다.

결제에서는 이 문제가 곧바로 데이터 모델로 번졌다. 초기에 한 PG사의 결제수단 기준으로 컬럼을 나눠두면 정돈돼 보이지만, PG가 추가되는 순간 전제가 깨졌다. 컬럼 구조가 꼬이고 매핑 규칙이 늘어나면서 복잡도가 급격히 올라갔다. 결제 자체가 이미 어려운 도메인이라 결국 일부는 if 분기로 눌러 운영했다. 보기 좋은 스키마보다 변경을 흡수하는 완충층이 먼저라는 걸 이때 체감했다.

반대로 위임을 넓혀 단순해진 경험도 있었다. 스트라이프를 처음 써보니 결제 처리만이 아니라 주문 흐름의 많은 부분을 플랫폼에 맡길 수 있게 되어 있었다. 우리 서비스 안에 중복 구현된 부분을 줄일 여지가 분명했다. 하지만 URL/QR 영역처럼 위임의 대가가 분명한 경우도 있다. 원본 URL이 길어질수록 QR 버전이 올라 인식률이 떨어지기 때문에 단축 URL이 필요해지지만, 동시에 스캔 비용, 광고, 유효기간 같은 제약이 같이 들어온다.

지금은 연동 설계를 취향 문제가 아니라 책임 배분 문제로 본다. 문서는 참고자료로 두고 실제 응답으로 계약을 검증하고, 내부 모델은 외부 스키마와 느슨하게 연결한다. 또 위임을 택할 때는 기능 목록보다 비용 모델과 철수 조건을 먼저 적는다. 당시 기록이 트윗 중심이라 정량 지표까지 남아 있지는 않아서, 여기서는 반복적으로 확인한 패턴 위주로만 정리했다.
