---
title: "테이블 데이터의 양이 으마으마해지면 그냥 테이블을 분리해야 하지 않을까 막연히 생각했었는데 테이블을 분리할 조건으로 인덱스를 분리"
description: "인덱스 분리, 레플리카 지연, 외부 API 비결정성, CDN 비용 판단을 한 축으로 묶어 예측 가능한 동작을 설계할 때의 기준을 정리한 글."
pubDate: 2023-04-02T22:35:13+00:00
source: twitter
tags:
  - database
  - consistency
  - reliability
  - architecture
  - backend
---

데이터가 커지기 시작하면 보통 테이블부터 쪼개야 한다고 생각하기 쉽다. 나도 처음엔 그렇게 막연히 봤다. 그런데 실제 판단은 조금 달랐다. 테이블 분리 전에 인덱스를 분리해 접근 경로를 나누면 비슷한 효과를 기대할 수 있다는 점을 확인했다. 테이블을 먼저 나누면 쿼리, 배포, 복구 범위가 한 번에 커지는데, 인덱스 단위 조정은 변경 면적을 더 작게 잡을 수 있다. 스케일 대응에서 중요한 건 “무엇을 분리하느냐”보다 “어디까지 바뀌느냐”였다.

비용도 같은 방식으로 봐야 했다. CDN 비용이 N천만원대로 보였을 때는 숫자만 보고 먼저 긴장했다. 하지만 수요와 공급의 관점에서 보면 그 비용은 트래픽과 응답성을 사는 선택일 수 있다. 실제로 서비스가 CDN 의존도가 높다면 과금은 실패 신호가 아니라 사용량 신호에 가깝다. 결국 판단 기준은 단순히 비싸고 싸고가 아니라, 이 지출이 사용자 경험과 운영 안정성을 동시에 지키는 데 맞는지였다.

일관성 문제는 더 직접적이었다. 몽고DB 클러스터에서 방금 넣은 데이터가 리드 레플리카에 바로 보이지 않는 상황을 페어 작업으로 확인했다. 라이터 인스턴스에 직접 붙기 어렵고 동기화 타이밍도 고정돼 있지 않으면, 같은 요청이 상황에 따라 다른 결과를 낸다. 이 상태에서는 장애 원인 분석이 느려질 수밖에 없다. 그래서 읽기 경로를 하나로 보지 말고, 즉시 일관성이 필요한 조회와 지연을 허용할 조회를 분리해 다뤄야 한다는 결론에 닿았다.

외부 API도 본질은 같았다. 같은 파라미터인데 결과가 달라지면 코드 이전에 재현성이 깨진다. 이럴 때는 추상화 계층을 늘리는 것보다 상태를 복제한 실행 환경을 한 벌 두고 입력과 상태를 고정하는 편이 실무에서 더 빠르다. 트윗 기반 기록이라 트래픽 규모나 내부 정책의 전체 맥락은 제한적이지만, 적용 포인트는 분명하다. 스케일 이슈 대응은 거대한 분리 작업보다, 결과를 예측 가능하게 만드는 경계와 비용 기준을 먼저 세우는 일에서 시작한다.
