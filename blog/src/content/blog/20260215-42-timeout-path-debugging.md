---
title: "CDN겸 로드밸런서가 장애가 났다는데 프라이빗네트워크내의 서비스간 호출이 타임아웃이 났다."
description: CPU가 정상인데도 요청이 실패하던 상황에서 실제 호출 경로와 레플리카 지연을 함께 검증하며 정리한 장애 분석 기록.
pubDate: 2023-10-11T13:53:04+00:00
source: twitter
tags:
  - 장애분석
  - 네트워크
  - AWS
  - PostgreSQL
  - 운영
---

장애 알림은 CDN 겸 로드밸런서였는데, 이상하게 프라이빗 네트워크 내부 서비스 간 호출도 타임아웃이 났다. 내부 통신이면 외부 이슈와 분리돼야 한다고 봤지만 실제 경로는 달랐다. 일부 호출이 내부 주소로 가지 않고 네트워크 밖으로 나갔다가 로드밸런서를 거쳐 다시 들어오고 있었다. CPU는 크게 흔들리지 않는데 요청만 실패한 이유가 여기였다. 병목은 자원이 아니라 숨은 경로 의존성이었다.

그래서 분석 순서를 바꿨다. 리소스 그래프보다 먼저 요청이 실제로 어디를 지나는지 확인했다. 서비스별 목적지 도메인, DNS 해석, 외부 경유 여부를 호출 단위로 다시 맞췄다. 내부 호출은 내부 엔드포인트로 고정하고 외부 경유가 섞이는 지점을 분리했다. 이 작업을 하고 나서야 타임아웃이 특정 코드 구간의 문제가 아니라 경로 설계의 리스크라는 점이 선명해졌다.

비슷한 패턴은 DB에서도 나왔다. AWS RDS Postgres에서 서버리스 리드 레플리카를 쓰는 환경에서, 부하가 걸릴 때 가끔 커넥션 수가 급격히 줄었다. 같은 시점에 AuroraReplicaLagMaximum은 튀는데 CPU는 정상 범위였다. 느린 쿼리, 과도한 트랜잭션, 데드락 같은 전형적 신호도 뚜렷하지 않았다. 레플리카 동기화 지연이나 자동 복구 과정에서 연결이 끊겼을 가능성을 의심했지만, 결정적인 원인은 끝내 확정하지 못했다.

정리하면 기준은 단순하다. CPU가 멀쩡해도 정상으로 단정하지 않고, 장애는 점진적이기보다 한 번에 무너질 수 있다고 가정한다. 그리고 마지막 실패를 만든 가장 약한 고리를 찾는다. 그래서 지금은 지표를 볼 때 경로 검증, 레플리카 지연, 연결 변화를 함께 본다. 원인을 항상 즉시 못 박을 수는 없지만, 사실과 추정을 분리해 기록하면 다음 장애에서 탐색 범위를 훨씬 빨리 줄일 수 있었다.
