---
title: "이메일 서비스인 샌드그리드는 실수로 한번의 api호출로 수십만건의 이메일을 발송하려고 하면 request too large 오류가"
description: 메일 발송 사고 가능성과 벤더 숨은 동작을 겪으면서, build vs buy를 운영 책임 기준으로 다시 정리한 기록.
pubDate: 2023-04-02T22:35:13+00:00
source: twitter
tags:
  - sendgrid
  - email
  - qa
  - build-vs-buy
  - platform
---

메일 발송 기능을 붙일 때는 기능 완성보다 사고 반경을 먼저 본다. SendGrid는 한 번의 API 호출에 너무 많은 수신자를 넣으면 `request too large`로 막아준다. 처음엔 불편한 제한처럼 보였는데, 실제로는 오발송을 초기에 끊는 안전장치에 가깝다. 발송 코드가 잠깐 꼬여도 서비스 전체 사고로 번지지 않게 해준다. 그래서 구현 초반부터 배치 크기 상한, 재시도 조건, 실패 시 중단 기준을 코드에서 강제하는 쪽으로 설계를 바꿨다.

문제는 반대로 벤더가 “알아서” 처리하는 동작이었다. 일괄 발송에서 같은 메일을 여러 건 넣었더니 여러 통이 아니라 한 통만 가는 상황을 QA 중에 만났다. 반나절 동안 원인을 주고받고 나서야 이게 버그가 아니라 스펙이라는 걸 확인했다. 이 경험 이후에는 벤더 기본 동작을 가정하지 않고, 요청 생성 단계에서 중복 정책을 명시적으로 통제한다. QA 케이스도 정상 데이터만 돌리지 않고 중복, 경계값, 대량 요청을 분리해서 본다.

비슷한 이유로 고객 행동 추적 일부는 직접 개발을 고집하지 않았다. 예전에는 내부 구현이 통제권을 준다고 생각했지만, 운영과 유지보수까지 합치면 내가 떠안는 책임 면적이 계속 커졌다. 조직이 바뀐 뒤에는 특히 우선순위를 더 좁혀야 했다. 그래서 핵심 도메인에 직접 영향이 큰 부분만 내부에 두고, 나머지는 서드파티로 옮겼다. 기준은 단순했다. “만들 수 있나”가 아니라 “지속해서 책임질 수 있나”.

비용 판단도 같은 축으로 봤다. 초기에 CDN 비용이 N천만원까지 나와 긴장했지만, 경영진은 사업 구조 안에서 감당 가능한 비용으로 판단했다. 그 뒤로 플랫폼 선택은 기술 선호보다 운영 리스크와 소유 비용으로 정리한다. 실수 방지 한도, 숨은 기본 동작, 장애 시 복구 경로, 팀 유지 가능 범위. 이 네 가지를 먼저 확인하면 build와 buy 사이에서 감정이 아니라 기준으로 결정할 수 있다. 다만 벤더 스펙은 바뀔 수 있어서 문서 재확인과 회귀 QA는 주기적으로 반복해야 한다.
