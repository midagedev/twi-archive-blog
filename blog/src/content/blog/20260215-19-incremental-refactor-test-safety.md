---
title: 작게 리팩토링하고 먼저 테스트를 쌓는 이유
description: 오래 운영된 프로덕션 코드에서 대규모 개편 대신 작은 리팩토링과 선행 테스트로 변경 리스크를 줄인 작업 방식.
pubDate: 2023-10-12T12:34:09+00:00
source: twitter
tags:
  - 리팩토링
  - 테스트코드
  - 레거시코드
  - 기술부채
---

출시 후 2년이 지난 프로덕션 코드를 맡았을 때, 가장 큰 문제는 코드스멜보다 수정 공포였다. 테스트가 거의 없으면 작은 변경도 배포 직전까지 불안이 남는다. 그러면 리팩토링도 쉽게 대규모 작업으로 커지고, 한 번에 많이 바꾸려다 되돌리는 비용이 더 커진다. 요즘처럼 에이전트 도구로 구현 속도가 빨라진 환경에서는 이 유혹이 더 강해진다.

그래서 기준을 단순하게 잡았다. 리팩토링은 작게 하고, 테스트를 먼저 넣는다. 입사 3일차 첫 PR에서는 백엔드 서비스에 통합 테스트를 추가해 기존 동작을 고정했고, 4일차에는 리액트 SPA에 단위 테스트를 처음 넣었다. 겉으로는 작은 변화지만, 오래된 코드베이스에서는 이 순서가 실제 위험을 가장 많이 줄였다. “구조를 다 바꾸자”보다 “지금 건드리는 구간부터 안전하게 만들자”가 맞았다.

실행할 때도 같은 원칙을 반복했다. 변경 범위를 넓히지 않고, 손대는 경로 주변만 검증 가능한 단위로 자른다. 도구는 상황에 맞게 바꿨다. 한 도구의 토큰이 부족하면 다른 도구를 붙여서 흐름을 유지했다. 중요한 건 도구 자체가 아니라, 임계점을 넘지 않는 크기로 나누는 판단과 변경 전후 동작을 테스트로 남기는 습관이었다.

이 방식의 결과는 화려한 지표보다 팀의 체감에서 먼저 나타난다. “여기 수정하기 무섭다”는 말이 줄고, 급한 구현이 들어와도 통제 가능한 빚만 지는 선택이 가능해진다. 테스트를 예금에 비유하면, 필요할 때 레버리지를 쓰더라도 상환 가능한 범위를 계산할 수 있는 상태를 만든다. 다만 커버리지 수치나 장애 감소 같은 정량 결과는 여기서 단정할 정보가 없다. 그래서 지금도 원칙은 같다. 작게 바꾸고, 먼저 고정하고, 그다음 확장한다.
