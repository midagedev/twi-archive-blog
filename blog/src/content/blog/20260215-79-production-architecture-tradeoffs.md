---
title: "11시에 딱 오픈하는 상품을 11시에 딱 보이게 하는것 11시부터 천원 할인 되는걸 가격순 정렬에 잘 보이게 하는것 이런건 RDB"
description: "프로모션 운영에서 RDB, 검색 스택, 캐시, 배포 방식을 팀의 운영 여력에 맞게 나눠 가져간 판단을 정리했다."
pubDate: 2024-05-03T14:49:40+00:00
source: twitter
tags:
  - 아키텍처
  - RDB
  - Elasticsearch
  - 캐시
  - 프로모션
---

프로모션 시스템에서 먼저 맞춰야 하는 건 화려한 구조가 아니라 시점의 정확도다. 11시에 오픈되는 상품이 11시에 보여야 하고, 11시부터 1,000원 할인되는 가격이 정렬에도 바로 반영돼야 한다. 이런 요구는 RDB에서는 조건과 정렬, 트랜잭션으로 비교적 직관적으로 다룰 수 있다. 반대로 검색 인덱스가 핵심 판정자가 되면 데이터 동기화와 집계 모델을 따로 설계해야 하고, 지연이나 불일치가 생겼을 때 복구 경로까지 같이 책임져야 한다. 팀에 이미 할 일이 많은 상황이라면 이 차이는 생각보다 크게 온다.

그래서 기준을 단순하게 잡는 편이 낫다. 시간과 가격처럼 “지금 이 값이 맞아야 하는” 도메인은 RDB를 기준으로 두고, 검색은 탐색성과 노출 보조 역할로 제한한다. 이렇게 경계를 나누면 복잡도가 줄고, 장애가 났을 때 어디를 먼저 봐야 할지도 명확해진다. 기술적으로 더 세련된 선택이 있어도, 현재 팀이 감당 가능한 운영 난도인지 먼저 확인하는 게 실제로는 더 안전하다.

운영 형태도 같은 맥락이다. 엘라스틱서치는 스토리지와 강하게 묶인 상태 저장 시스템인데, 이를 쿠버네티스 파드 안에서 굴릴지 여부는 단순 취향 문제가 아니다. 디스크, 스냅샷, 복구, 성능 튜닝까지 누가 어떤 시간 안에 책임질지를 먼저 정해야 한다. EC2 로컬 도커 같은 단순한 형태가 완성형은 아니어도, 현재 인력과 숙련도에서 장애 복구 시간이 짧다면 그게 더 현실적인 선택일 수 있다.

행사 당일 대응도 비슷했다. 직전 한 시간 안에 리드 리플리카를 추가해 읽기 부하를 분산했고, 모니터링을 보면서 병목을 즉시 확인했다. 큰 구조 개편보다 그날의 트래픽 패턴에 맞춘 빠른 조정이 효과적이었다는 의미다. 프로모션은 “완벽한 설계”보다 “짧은 시간 안에 안전하게 조정 가능한 구조”가 결과를 만든다.

마지막으로 캐시와 비정상 트래픽은 별도 항목으로 다뤄야 한다. `WKWebView`의 공격적인 캐시 정책과 정적 생성 결과를 잘못 섞으면 서버를 안 치고 오래된 화면이 남는 일이 생긴다. 또 예상하지 못한 헤드리스 크롤러가 세션 체크 스크립트를 대량 트리거해 지표를 왜곡할 수도 있다. 결국 핵심은 같다. 정합성이 필요한 경로는 단순하고 검증 가능하게 두고, 캐시와 크롤러 같은 주변 변수는 명시적으로 통제해야 한다. 아키텍처의 품질은 기능 수보다, 문제를 빨리 찾고 되돌릴 수 있는 운영성에서 드러난다.
