---
title: 타임딜 반영이 중요한 커머스 검색에서 ES 대신 RDB를 택한 이유
description: 정형 상품 데이터를 다루는 커머스 검색에서 ES 운영 비용과 동기화 부담을 줄이고, RDB 쿼리·인덱스 최적화로 실시간 요구사항을 맞춘 경험을 정리했다.
pubDate: 2024-01-02T13:44:58+00:00
source: twitter
tags:
  - ecommerce
  - search
  - postgres
  - elasticsearch
  - backend
---

커머스 검색에서 가장 어려웠던 건 검색 정확도보다 반영 시점이었다. 11시에 오픈하는 상품은 11시에 보여야 하고, 11시부터 천 원 할인되는 상품은 가격순 정렬에서 바로 위치가 바뀌어야 했다. 데이터 자체는 거의 정형인데, ES를 사이에 두니 색인 동기화 지연과 정렬 기준 불일치 대응이 반복됐다. 기능을 만드는 시간보다 “왜 지금 보이는 값이 다르지”를 설명하고 복구하는 시간이 더 길어졌다.

비정형 데이터 검색이나 풀텍스트 검색이 핵심이면 ES는 좋은 선택이다. 하지만 우리 요구사항은 구조가 단순하고 시간 민감도가 높았다. 이 경우 ES를 넣는 순간 노드 관리, 인덱스 운영, 동기화 파이프라인 같은 관리 포인트가 확 늘어난다. 실시간성을 강하게 맞추려면 이벤트소싱이나 어그리게이션 같은 보조 구조까지 따라오는데, 그 비용이 팀의 현재 우선순위와 맞지 않았다. 그래서 검색 스택을 RDB 중심으로 다시 설계했다.

실행은 단순하게 갔다. 조회/쓰기 경로를 분리하는 CQRS 패턴을 RDB 안에서 적용하고, 검색어 처리는 필요한 수준의 형태소 분석만 얹었다. 성능은 결국 쿼리와 인덱스에서 갈렸다. 특히 전체 데이터 중 일부 조건만 자주 읽는 구간에 파셜 인덱스를 두자 차이가 컸다. 인덱스를 쓰더라도 인덱스 자체가 크면 스캔 비용이 커지는데, 조건을 좁힌 인덱스가 이 비용을 크게 줄였다. 당시 특정 쿼리 기준으로는 약 10배 개선을 확인했다.

결과적으로 타임딜 가격 반영과 노출 시점 제어는 RDB가 더 예측 가능했고 운영도 단순했다. 장애 대응 포인트가 줄어 팀 집중도도 올라갔다. 물론 이 선택이 항상 정답은 아니다. 문서형 데이터 비중이 높거나 복잡한 전문 검색이 제품 핵심이면 ES가 필요하다. 다만 정형 데이터 중심의 커머스에서는 데이터 형태, 반영 지연 허용치, 운영 여력을 먼저 숫자로 정리하고, 그다음에 스택을 늘리는 순서가 실무에서 더 안전했다.
