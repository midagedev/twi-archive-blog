---
title: 레이어를 늘릴 시점과 검증 경계를 정하는 기준
description: 프로토타입 속도에서 운영 코드로 넘어갈 때, 얇은 레이어 유지와 모델 레벨 검증 사이의 판단 기준을 정리했다.
pubDate: 2023-03-26T01:37:22+00:00
source: twitter
tags:
  - architecture
  - validation
  - domain-model
  - refactoring
---

초기에는 레이어를 얇게 두는 편이 확실히 빠르다. 프레임워크가 주는 매직도 이 시기엔 생산성을 올려준다. 문제는 코드가 길게 유지될 때다. 계속 교체되는 여러 사람이 만지는 코드베이스가 커지면, “쉽게 되는 것” 자체가 리스크가 된다. 어디서 규칙이 보장되는지 보이지 않고, 주의해야 할 포인트가 늘어나면서 편의보다 확인 비용이 더 커진다.

그래서 레이어를 늘릴지 말지는 취향보다 타이밍 문제에 가깝다. 복잡한 비즈니스 규칙이 생겼는데도 물리 모델과 핸들러만으로 버티면 변경이 퍼지고 리뷰가 느려진다. 반대로 아직 단순한데 도메인 모델과 서비스 레이어를 먼저 깔아두면 구조 설명 비용이 먼저 나온다. 결국 기준은 “규칙이 여러 경로에서 반복되기 시작했는가”와 “한 변경이 여러 진입점으로 번지는가”였다. 이 두 가지가 보이면 레이어를 추가하고, 아니면 얇게 유지한다.

검증은 가능하면 모델 경계에 둔다. 예를 들어 type이 a면 price는 1000 이상, b면 미만이어야 한다는 규칙이 있을 때, type과 price를 바꾸는 메서드가 여러 개면 각 메서드에 같은 체크를 복사하는 순간 누락이 생긴다. 그래서 엔드포인트나 서비스마다 부분 검증을 두기보다, 모델 단에서 불변식을 강제하는 쪽이 안전했다. 다만 릴레이션까지 같이 검증해야 하는 규칙은 깔끔하게 떨어지지 않는 경우가 있었고, 이 구간은 아직도 설계 선택지가 남는다.

겉으로 단순해 보이는 이슈가 실제로는 기존 구조 전체를 읽어야 풀리는 이유도 여기 있다. 어디서 상태가 바뀌는지, 누가 규칙을 보장하는지 먼저 드러내지 않으면 시작점이 안 잡힌다. 정량 지표를 남긴 건 아니지만, 이 기준을 공유한 뒤에는 리뷰에서 “어디에 규칙을 둘지”를 두고 같은 대화를 반복하는 일이 줄었다. 적용할 때는 거창한 리라이트보다, 변경 경로를 먼저 그린 뒤 필요한 경계만 한 겹씩 추가하는 방식이 가장 덜 위험했다.
